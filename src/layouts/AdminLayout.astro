---
import { authGuardScript } from "@/lib/auth";
import HeadSEO from "@/components/HeadSEO.astro";

interface Props {
  title: string;
  description?: string;
}

const { 
  title, 
  description = "Admin dashboard for The Ford Family blog."
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <HeadSEO title={title} description={description} />
    <link rel="stylesheet" href="/styles/global.css" />
    <Fragment set:html={authGuardScript} />
  </head>
  <body class="min-h-screen bg-background font-sans antialiased">
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <div class="w-64 bg-muted/30 border-r border-border hidden md:block">
        <div class="h-16 flex items-center px-6 border-b border-border">
          <h1 class="text-xl font-semibold font-display text-primary-foreground">Admin Dashboard</h1>
        </div>
        <nav class="p-4 space-y-2">
          <a href="/admin/dashboard" class="block p-2 hover:bg-accent hover:text-accent-foreground rounded transition-colors">
            Dashboard
          </a>
          <a href="/admin/new-post" class="block p-2 hover:bg-accent hover:text-accent-foreground rounded transition-colors">
            New Post
          </a>
          <a href="/admin/manage-posts" class="block p-2 hover:bg-accent hover:text-accent-foreground rounded transition-colors">
            Manage Posts
          </a>
          <a href="/" class="block p-2 hover:bg-accent hover:text-accent-foreground rounded transition-colors">
            View Site
          </a>
          <button id="logout-button" class="block w-full text-left p-2 hover:bg-accent hover:text-accent-foreground rounded transition-colors">
            Logout
          </button>
        </nav>
      </div>
      
      <!-- Main Content -->
      <div class="flex-1">
        <!-- Top Nav -->
        <header class="h-16 border-b border-border flex items-center px-6">
          <button id="mobile-menu-button" class="md:hidden mr-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
          <div class="flex-1">
            <h2 class="text-lg font-medium">{title}</h2>
          </div>
          <div>
            <span class="text-sm" id="username-display"></span>
          </div>
        </header>
        
        <!-- Mobile Menu (hidden by default) -->
        <div id="mobile-menu" class="md:hidden hidden bg-muted/30 border-b border-border">
          <nav class="p-4 space-y-2">
            <a href="/admin/dashboard" class="block p-2 hover:bg-accent hover:text-accent-foreground rounded transition-colors">
              Dashboard
            </a>
            <a href="/admin/new-post" class="block p-2 hover:bg-accent hover:text-accent-foreground rounded transition-colors">
              New Post
            </a>
            <a href="/admin/manage-posts" class="block p-2 hover:bg-accent hover:text-accent-foreground rounded transition-colors">
              Manage Posts
            </a>
            <a href="/" class="block p-2 hover:bg-accent hover:text-accent-foreground rounded transition-colors">
              View Site
            </a>
            <button id="mobile-logout-button" class="block w-full text-left p-2 hover:bg-accent hover:text-accent-foreground rounded transition-colors">
              Logout
            </button>
          </nav>
        </div>
        
        <!-- Page Content -->
        <main class="p-6">
          <slot />
        </main>
      </div>
    </div>
    
    <script>
      // Mobile menu toggle
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      
      mobileMenuButton?.addEventListener('click', () => {
        mobileMenu?.classList.toggle('hidden');
      });
      
      // Handle logout
      function handleLogout() {
        localStorage.removeItem('auth');
        window.location.href = '/login';
      }
      
      document.getElementById('logout-button')?.addEventListener('click', handleLogout);
      document.getElementById('mobile-logout-button')?.addEventListener('click', handleLogout);
      
      // Display username
      const usernameDisplay = document.getElementById('username-display');
      try {
        const authData = localStorage.getItem('auth');
        if (authData) {
          const auth = JSON.parse(authData);
          if (auth.user && auth.user.username) {
            usernameDisplay.textContent = auth.user.username;
          }
        }
      } catch (error) {
        console.error('Error displaying username:', error);
      }
    </script>
  </body>
</html>