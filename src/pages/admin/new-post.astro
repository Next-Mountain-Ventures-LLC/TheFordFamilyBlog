---
import AdminLayout from "@/layouts/AdminLayout.astro";
import BlogPostForm from "@/components/BlogPostForm";
import { getCollection } from 'astro:content';

// Get all existing categories with count
const allBlogPosts = await getCollection('blog');
const categoryMap = new Map();

allBlogPosts.forEach(post => {
  const category = post.data.category;
  if (!categoryMap.has(category)) {
    categoryMap.set(category, 0);
  }
  categoryMap.set(category, categoryMap.get(category) + 1);
});

const categories = Array.from(categoryMap.entries()).map(([name, count]) => ({
  name,
  count
}));
---

<AdminLayout title="Create New Blog Post">
  <div class="bg-white rounded-lg shadow-sm border border-border p-6">
    <h1 class="text-2xl font-bold mb-6">Create New Blog Post</h1>
    
    <BlogPostForm client:load categories={categories} />
  </div>
</AdminLayout>