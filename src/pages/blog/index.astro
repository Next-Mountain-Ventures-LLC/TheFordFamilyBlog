---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { buttonVariants } from "@/components/ui/button";
import { Image } from 'astro:assets';
import joshuaImage from '../../assets/img_9071_nw_c2f17e0f.jpg';
import saliciaImage from '../../assets/salicias-profile_nw_7fb06e56.jpg';
import jacksonImage from '../../assets/jackson_ford_nw_10531fa1.jpg';
import { getPosts, getCategories, WordPressCategory } from '@/lib/wordpress';

// Fallback category data
const fallbackCategories: WordPressCategory[] = [
  {
    id: 1,
    name: "Uncategorized",
    slug: "uncategorized",
    description: "",
    link: "",
    taxonomy: "category",
    count: 1,
    parent: 0
  },
  {
    id: 2,
    name: "Entrepreneurship",
    slug: "entrepreneurship",
    description: "",
    link: "",
    taxonomy: "category",
    count: 2,
    parent: 0
  },
  {
    id: 3,
    name: "Faith & Health",
    slug: "faith-health",
    description: "",
    link: "",
    taxonomy: "category",
    count: 2,
    parent: 0
  },
  {
    id: 4,
    name: "Homeschooling",
    slug: "homeschooling",
    description: "",
    link: "",
    taxonomy: "category",
    count: 1,
    parent: 0
  },
  {
    id: 5,
    name: "Inventions",
    slug: "inventions",
    description: "",
    link: "",
    taxonomy: "category",
    count: 2,
    parent: 0
  },
  {
    id: 6,
    name: "Family",
    slug: "family",
    description: "",
    link: "",
    taxonomy: "category",
    count: 1,
    parent: 0
  }
];

// Fallback blog post data
const fallbackPosts = [
  {
    id: 1,
    title: "Road Blocks: Navigating the Entrepreneurial Journey",
    excerpt: "Insights on overcoming common obstacles entrepreneurs face while building their businesses.",
    date: "September 24, 2025",
    author: "Joshua Ford",
    category: "Entrepreneurship",
    imageUrl: joshuaImage.src,
    slug: "road-blocks",
    content: ""
  },
  {
    id: 2,
    title: "Finding Strength in Faith Through Health Challenges",
    excerpt: "How our family relies on faith during difficult times with chronic illness and health challenges.",
    date: "June 12, 2025",
    author: "Salicia Ford",
    category: "Faith & Health",
    imageUrl: saliciaImage.src,
    slug: "faith-through-health-challenges",
    content: ""
  },
  {
    id: 3,
    title: "Homeschooling Tips for ADHD Children",
    excerpt: "Practical strategies and templates for creating a successful homeschooling environment for children with ADHD.",
    date: "June 5, 2025",
    author: "Salicia Ford",
    category: "Homeschooling",
    imageUrl: saliciaImage.src,
    slug: "homeschooling-tips-adhd",
    content: ""
  },
  {
    id: 4,
    title: "3D Printing Projects for Young Inventors",
    excerpt: "Jackson shares his favorite beginner-friendly 3D printing projects that teach engineering concepts to kids.",
    date: "May 30, 2025",
    author: "Jackson Ford",
    category: "Inventions",
    imageUrl: jacksonImage.src,
    slug: "3d-printing-young-inventors",
    content: ""
  },
  {
    id: 5,
    title: "Navigating Healthcare Systems as a Chronic Illness Patient",
    excerpt: "Tips and advice for advocating for yourself in complex medical systems when dealing with chronic conditions.",
    date: "May 25, 2025",
    author: "Salicia Ford",
    category: "Faith & Health",
    imageUrl: saliciaImage.src,
    slug: "navigating-healthcare-systems",
    content: ""
  },
  {
    id: 6,
    title: "Building Your First E-Bike: A Family Project",
    excerpt: "How our family bonded while creating a custom electric bicycle, with step-by-step guidance for your own build.",
    date: "May 18, 2025",
    author: "Joshua Ford",
    category: "Inventions",
    imageUrl: joshuaImage.src,
    slug: "building-first-ebike",
    content: ""
  },
  {
    id: 7,
    title: "Starting a Business as a Teenager: Jackson's Journey",
    excerpt: "My son shares his experience launching a 3D printing business at 12 and the lessons he's learned along the way.",
    date: "May 10, 2025",
    author: "Joshua Ford",
    category: "Entrepreneurship",
    imageUrl: joshuaImage.src,
    slug: "teenage-business-journey",
    content: ""
  },
  {
    id: 8,
    title: "Creating Your First YouTube Channel as a Family",
    excerpt: "How we started our family YouTube presence and tips for creating content that reflects your values.",
    date: "May 3, 2025",
    author: "Finley Ford",
    category: "Family",
    imageUrl: "https://images.unsplash.com/photo-1626763847023-b8ff4c3a8a5b?w=800&auto=format&q=80",
    slug: "family-youtube-channel",
    content: ""
  },
  {
    id: 9,
    title: "Finley's Fashion Tips for Young Creators",
    excerpt: "My daughter shares her approach to developing a personal style that expresses creativity and individuality.",
    date: "April 28, 2025",
    author: "Finley Ford",
    category: "Design",
    imageUrl: "https://images.unsplash.com/photo-1638604587609-fbb8469f4234?w=800&auto=format&q=80",
    slug: "fashion-tips-young-creators",
    content: ""
  }
];

// Fetch blog posts from WordPress API
let blogPosts = fallbackPosts;
try {
  console.log("Attempting to fetch WordPress posts for blog index...");
  blogPosts = await getPosts(20);
  console.log("Successfully fetched WordPress posts for blog index:", blogPosts.length);
} catch (error) {
  console.error('Error fetching WordPress posts for blog index:', error);
  console.log("Using fallback blog post data for blog index");
}

// Fetch categories from WordPress API
let wpCategories = fallbackCategories;
try {
  console.log("Attempting to fetch WordPress categories...");
  wpCategories = await getCategories();
  console.log(`Successfully fetched ${wpCategories.length} WordPress categories`);
} catch (error) {
  console.error('Error fetching WordPress categories:', error);
  console.log("Using fallback category data");
}

// Filter out categories with no posts
const activeCategories = wpCategories.filter(category => category.count > 0);

// Organize posts by featured and regular
const featuredPost = blogPosts[0];
const regularPosts = blogPosts.slice(1);
---

<BaseLayout 
  title="The Ford Family Blog - Faith, Health, Homeschooling & Entrepreneurship" 
  description="Explore our family's journey through faith, health challenges, homeschooling, entrepreneurship, and creativity."
>
  <div class="bg-muted/20 py-16 border-b border-primary/10">
    <div class="container mx-auto text-center">
      <h1 class="text-4xl md:text-6xl font-bold font-display mb-4 text-primary-foreground">
        Our Family Blog
      </h1>
      <p class="text-xl max-w-2xl mx-auto text-muted-foreground mb-8">
        Stories, insights, and inspiration from our journey through faith, health challenges, homeschooling, and entrepreneurship.
      </p>
      <div class="flex flex-wrap justify-center gap-3 max-w-2xl mx-auto">
        {activeCategories.map((category) => (
          <a 
            href={`/blog/category/${category.slug}`}
            class="px-4 py-2 bg-white/80 hover:bg-white shadow-sm rounded-full text-sm transition-colors"
          >
            {category.name}
          </a>
        ))}
      </div>
    </div>
  </div>

  <main class="py-16">
    <div class="container mx-auto">
      <!-- Featured Post -->
      <div class="mb-16">
        <h2 class="text-2xl font-bold font-display mb-6 text-primary-foreground">Featured Post</h2>
        <div class="scrapbook-paper bg-white/95 p-0 overflow-hidden">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="relative h-full min-h-[300px] overflow-hidden">
              <img 
                src={featuredPost.imageUrl} 
                alt={featuredPost.title}
                class="absolute inset-0 w-full h-full object-cover"
              />
            </div>
            <div class="p-8">
              <div class="mb-3">
                <a 
                  href={featuredPost.categorySlug ? `/blog/category/${featuredPost.categorySlug}` : '#'} 
                  class="inline-block px-3 py-1 bg-primary/10 text-primary-foreground text-xs rounded-full hover:bg-primary/20 transition-colors"
                >
                  {featuredPost.category}
                </a>
              </div>
              <h3 class="text-2xl font-bold font-display mb-3">
                <a href={`/blog/${featuredPost.slug}`} class="hover:text-primary transition-colors">
                  {featuredPost.title}
                </a>
              </h3>
              <p class="text-muted-foreground mb-4">
                {featuredPost.excerpt}
              </p>
              <div class="flex items-center text-sm mb-4">
                <div class="flex items-center mr-4">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                  <a 
                    href={featuredPost.authorSlug ? `/blog/author/${featuredPost.authorSlug}` : '#'}
                    class="hover:text-primary transition-colors"
                  >
                    {featuredPost.author}
                  </a>
                </div>
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                  <span>{featuredPost.date}</span>
                </div>
              </div>
              <a 
                href={`/blog/${featuredPost.slug}`} 
                class={buttonVariants({ variant: "default", size: "sm" })}
              >
                Read More
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Regular Posts -->
      <h2 class="text-2xl font-bold font-display mb-6 text-primary-foreground">Recent Posts</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {regularPosts.map((post) => (
          <article class="scrapbook-paper bg-white/90">
            <div class="mb-4">
              <div class="scrapbook-photo w-full" style={`--rotate: ${Math.random() > 0.5 ? "" : "-"}${Math.floor(Math.random() * 3)}deg;`}>
                <div class="scrapbook-tape"></div>
                <img 
                  src={post.imageUrl} 
                  alt={post.title}
                  class="w-full h-48 object-cover rounded-sm"
                />
              </div>
            </div>
            <div class="mb-3">
              <a 
                href={post.categorySlug ? `/blog/category/${post.categorySlug}` : '#'} 
                class="inline-block px-3 py-1 bg-primary/10 text-primary-foreground text-xs rounded-full hover:bg-primary/20 transition-colors"
              >
                {post.category}
              </a>
            </div>
            <h3 class="text-xl font-bold font-display mb-2 leading-tight">
              <a href={`/blog/${post.slug}`} class="hover:text-primary transition-colors">
                {post.title}
              </a>
            </h3>
            <p class="text-muted-foreground text-sm mb-4 line-clamp-3">
              {post.excerpt}
            </p>
            <div class="flex justify-between items-center text-xs text-muted-foreground mb-4">
              <a 
                href={post.authorSlug ? `/blog/author/${post.authorSlug}` : '#'}
                class="hover:text-primary transition-colors"
              >
                {post.author}
              </a>
              <span>{post.date}</span>
            </div>
            <a 
              href={`/blog/${post.slug}`} 
              class={buttonVariants({ variant: "outline", size: "sm" })}
            >
              Read Post
            </a>
          </article>
        ))}
      </div>

      <!-- Pagination -->
      <div class="flex justify-center mt-12">
        <nav class="flex items-center space-x-2">
          <a href="#" class="w-10 h-10 flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent hover:text-accent-foreground">
            <span class="sr-only">Previous page</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
          </a>
          <a href="#" class="w-10 h-10 flex items-center justify-center rounded-md bg-primary text-primary-foreground">1</a>
          <a href="#" class="w-10 h-10 flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent hover:text-accent-foreground">2</a>
          <a href="#" class="w-10 h-10 flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent hover:text-accent-foreground">3</a>
          <span class="w-10 h-10 flex items-center justify-center">...</span>
          <a href="#" class="w-10 h-10 flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent hover:text-accent-foreground">8</a>
          <a href="#" class="w-10 h-10 flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent hover:text-accent-foreground">
            <span class="sr-only">Next page</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
          </a>
        </nav>
      </div>

      <!-- Newsletter -->
      <div class="max-w-2xl mx-auto mt-24">
        <div class="scrapbook-paper bg-secondary/10">
          <div class="text-center">
            <h2 class="text-2xl font-bold font-display mb-3 text-secondary-foreground">Subscribe to Our Newsletter</h2>
            <p class="text-muted-foreground mb-6">
              Get the latest blog posts, family updates, and exclusive content delivered straight to your inbox.
            </p>
            <form class="max-w-md mx-auto flex gap-2">
              <input 
                type="email" 
                placeholder="Your email address" 
                class="flex-1 px-4 py-2 bg-white border border-border rounded-md"
                required
              />
              <button type="submit" class={buttonVariants({ variant: "default" })}>
                Subscribe
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>
</BaseLayout>