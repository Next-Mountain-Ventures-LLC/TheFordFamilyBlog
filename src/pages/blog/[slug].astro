---
import BlogLayout from "@/layouts/BlogLayout.astro";
import { getPostBySlug, getPosts } from '@/lib/wordpress';

// Generate static paths for all blog posts
export async function getStaticPaths() {
  try {
    // Fetch all posts from WordPress API
    const posts = await getPosts(100); // Increase limit as needed
    
    // Generate paths for each post
    return posts.map(post => ({
      params: { slug: post.slug },
      props: { post }
    }));
  } catch (error) {
    console.error('Error generating static paths for blog posts:', error);
    return []; // Return empty array if fetch fails
  }
}

// Get the post data from props
const { post } = Astro.props;

// Generate the SEO-friendly metadata
const { slug } = Astro.params; // Get slug from params for ogImage
const ogImage = new URL(`/og-images/${slug}.png`, Astro.site);
---

<BlogLayout
  title={post.title}
  description={post.excerpt}
  author={post.author}
  authorSlug={post.authorSlug}
  date={post.date}
  category={post.category}
  categorySlug={post.categorySlug}
  imageUrl={post.imageUrl}
  ogImage={ogImage}
  tags={post.tags}
>
  <!-- Use set:html to render the HTML content from WordPress -->
  <article set:html={post.content} />
</BlogLayout>

<style>
  /* Additional styles for WordPress content */
  :global(article img) {
    max-width: 100%;
    height: auto;
    border-radius: 0.25rem;
    margin: 1.5rem 0;
  }
  
  :global(article h2) {
    font-size: 1.5rem;
    font-weight: 700;
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-family: var(--font-display);
  }
  
  :global(article h3) {
    font-size: 1.25rem;
    font-weight: 700;
    margin-top: 1.5rem;
    margin-bottom: 1rem;
    font-family: var(--font-display);
  }
  
  :global(article p) {
    margin-bottom: 1rem;
    line-height: 1.6;
  }
  
  :global(article ul, article ol) {
    margin-left: 1.5rem;
    margin-bottom: 1rem;
  }
  
  :global(article li) {
    margin-bottom: 0.5rem;
  }
  
  :global(article blockquote) {
    border-left: 4px solid #e2e8f0;
    padding-left: 1rem;
    margin: 1.5rem 0;
    font-style: italic;
  }
</style>